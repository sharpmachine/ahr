/*
 * catalog.js - Shopp catalog behaviors library
 * Copyright ?? 2008-2010 by Ingenesis Limited
 * Licensed under the GPLv3 {@see license.txt}
 */
function ProductOptionsMenus(l,g,o,p){var f=jqnc(),h=0,k=false,m=false,n=new Array(),e=f(l),d="disabled";if(!p){p=0}e.each(function(r,i){m=i;n[r]=f(i).children();if(f.browser.msie){a(i)}if(r>0){k=e[r-1]}if(e.length==1){q()}else{if(k){f(k).change(function(){if(e.index(m)==e.length-1){q()}if(this.selectedIndex==0&&this.options[0].value==""){f(i).attr(d,true)}else{f(i).removeAttr(d)}}).change()}}h++});function q(){var r=new Array(),i=f(m).val();e.not(m).each(function(){if(f(this).val()!=""){r.push(f(this).val())}});f(m).empty();n[e.index(m)].each(function(t,s){f(s).appendTo(f(m))});f(m).val(i);f(m).children("option").each(function(){var z,u,s,y,x="",t=f(this),w=r.slice(),v;if(t.val()!=""){w.push(t.val());v=o[b(w)];if(!v){v=o[c(w)]}if(v){if(v.p){z=new Number(v.p);u=new Number(z*p);x="  ("+asMoney(new Number(z+u))+")"}s=t.attr("text");y=s.lastIndexOf("(");if(y!=-1){s=s.substr(0,y)}t.attr("text",s+x);if(f.browser.msie){t.css("color","#373737")}if((v.i&&!v.s)||v.t=="N/A"){if(t.attr("selected")){t.parent().attr("selectedIndex",0)}if(g){t.remove()}else{j(t)}}else{t.removeAttr(d).show()}if(v.t=="N/A"&&g){t.remove()}}else{if(g){t.remove()}else{j(t)}}}})}function b(t){for(var s=0,r=0;r<t.length;r++){s=s^(t[r]*7001)}return s}function c(t){for(var s=0,r=0;r<t.length;r++){s=s^(t[r]*101)}return s}function j(i){i.attr(d,true);if(!f.browser.msie){return}i.css("color","#ccc")}function a(i){f(i).change(function(){var r=this,s;if(!r.options[r.selectedIndex].disabled){r.lastSelected=r.selectedIndex;return true}if(r.lastSelected){r.selectedIndex=r.lastSelected}else{s=f(r).children("option:not(:disabled)").get(0);r.selectedIndex=s?s.index:0}})}}function catalogViewHandler(){var c=jqnc(),d=c("#shopp"),a=new Date(),b={list:"grid",grid:"list"};a.setTime(a.getTime()+(30*86400000));c.each(b,function(e,f){d.find("ul.views li button."+e).click(function(){d.removeClass(f).addClass(e);document.cookie="shopp_catalog_view="+e+"; expires="+a+"; path=/"}).hover(function(){c(this).toggleClass("hover")})})}function ShoppGallery(g,b,c){var e=jqnc(),a=e(g),d=a.find("ul.previews"),f=a.find("ul.thumbnails li");if(!b){b="click"}if(c){a.find("ul.thumbnails").css("width",c+"px")}f.bind(b,function(){var h,i=e("#"+e(this).attr("class").split(" ")[0]);if(!i.hasClass("active")){h=a.find("ul.previews li.active");i.addClass("active").hide();if(h.length){h.fadeOut(800,function(){h.removeClass("active")})}i.appendTo(d).fadeIn(500)}})}function ShoppSlideshow(d,h,c,f,a){var g=jqnc(),b=this,e;b.element=g(d);e={fade:[{display:"none"},{opacity:"show"}],"slide-down":[{display:"block",top:b.element.height()*-1},{top:0}],"slide-up":[{display:"block",top:b.element.height()},{top:0}],"slide-left":[{display:"block",left:b.element.width()*-1},{left:0}],"slide-right":[{display:"block",left:b.element.width()},{left:0}],wipe:[{display:"block",height:0},{height:b.element.height()}]},ordering=["normal","reverse","shuffle"];b.duration=(!h)?800:h;b.delay=(!c)?7000:c;f=(!f)?"fade":f;b.effect=(!e[f])?e.fade:e[f];a=(!a)?"normal":a;b.order=(g.inArray(a,ordering)!=-1)?a:"normal";b.slides=g(b.element).find("li:not(li.clear)").hide().css("visibility","visible");b.total=b.slides.length;b.slide=0;b.shuffling=new Array();b.startTransition=function(){var i,j,k=g(self.slides).find(".active").removeClass("active");g(b.slides[b.slide]).css(b.effect[0]).appendTo(b.element).animate(b.effect[1],b.duration,function(){k.css(b.effect[0])}).addClass("active");switch(b.order){case"shuffle":if(b.shuffling.length==0){b.shuffleList();i=g.inArray(b.slide,b.shuffling);if(i!=-1){b.shuffling.splice(i,1)}}j=Math.floor(Math.random()*b.shuffling.length);b.slide=b.shuffling[j];b.shuffling.splice(j,1);break;case"reverse":b.slide=(b.slide-1<0)?b.slides.length-1:b.slide-1;break;default:b.slide=(b.slide+1==b.total)?0:b.slide+1}if(b.slides.length==1){return}setTimeout(b.startTransition,b.delay)};b.transitionTo=function(i){b.slide=i;b.startTransition()};b.shuffleList=function(){for(var j=0;j<b.total;j++){b.shuffling.push(j)}};b.startTransition()}function slideshows(){var c=jqnc(),b,a,d;c("ul.slideshow").each(function(){b=c(this).attr("class");a={};d={fx:new RegExp(/([\w_-]+?)\-fx/),order:new RegExp(/([\w_-]+?)\-order/),duration:new RegExp(/duration\-(\d+)/),delay:new RegExp(/delay\-(\d+)/)};c.each(d,function(e,f){if(option=b.match(f)){a[e]=option[1]}});new ShoppSlideshow(this,a.duration,a.delay,a.fx,a.order)})}function ShoppCarousel(d,b){var c=jqnc(),a,g,h=this,i=c(d),e=i.find("ul"),f=e.find("> li");h.duration=(!b)?800:b;h.cframe=i.find("div.frame");a=Math.floor(h.cframe.innerWidth()/f.outerWidth());g=Math.round(((h.cframe.innerWidth()%f.outerWidth())/f.length)/2);f.css("margin","0 "+g+"px");h.pageWidth=(f.outerWidth()+(g*2))*a;h.page=1;h.pages=Math.ceil(f.length/a);if((f.length%a)!=0){e.append(new Array(a-(f.length%a)+1).join('<li class="empty" style="width: '+f.outerWidth()+"px; height: 1px; margin: 0 "+g+'px"/>'));f=e.find("> li")}f.filter(":first").before(f.slice(-a).clone().addClass("cloned"));f.filter(":last").after(f.slice(0,a).clone().addClass("cloned"));f=e.find("> li");h.cframe.scrollLeft(h.pageWidth);h.scrollLeft=i.find("button.left");h.scrollRight=i.find("button.right");h.scrolltoPage=function(k){var j=k<h.page?-1:1,m=Math.abs(h.page-k),l=h.pageWidth*j*m;h.cframe.filter(":not(:animated)").animate({scrollLeft:"+="+l},h.duration,function(){if(k==0){h.cframe.scrollLeft(h.pageWidth*h.pages);k=h.pages}else{if(k>h.pages){h.cframe.scrollLeft(h.pageWidth);k=1}}h.page=k})};h.scrollLeft.click(function(){return h.scrolltoPage(h.page-1)});h.scrollRight.click(function(){return h.scrolltoPage(h.page+1)})}function carousels(){var c=jqnc(),b,a,d;c("div.carousel").each(function(){b=c(this).attr("class");a={};d={duration:new RegExp(/duration\-(\d+)/)};c.each(d,function(e,f){if(option=b.match(f)){a[e]=option[1]}});new ShoppCarousel(this,a.duration)})}function validate(c){if(!c){return false}var d=jqnc(),h=true,g=new Array(),b=new Array(),a=d(c).find("input,select"),f="required",e="title";d.each(a,function(j,i){input=d(i).removeClass("error");label=d("label[for="+input.attr("id")+"]").removeClass("error");if(input.attr("disabled")==true){return}if(input.hasClass(f)&&input.val()==""){b=new Array(ShoppSettings.REQUIRED_FIELD.replace(/%s/,input.attr(e)),i)}if(input.hasClass(f)&&input.attr("type")=="checkbox"&&!input.attr("checked")){b=new Array(ShoppSettings.REQUIRED_CHECKBOX.replace(/%s/,input.attr(e)),i)}if(input.hasClass("email")&&!input.val().match(new RegExp("^[a-zA-Z0-9._-]+@([a-zA-Z0-9.-]+.)+[a-zA-Z0-9.-]{2,4}$"))){b=new Array(ShoppSettings.INVALID_EMAIL,i)}if(chars=input.attr("class").match(new RegExp("min(\\d+)"))){if(input.val().length<chars[1]){b=new Array(ShoppSettings.MIN_LENGTH.replace(/%s/,input.attr(e)).replace(/%d/,chars[1]),i)}}if(input.hasClass("passwords")){g.push(i);if(g.length==2&&g[0].value!=g[1].value){b=new Array(ShoppSettings.PASSWORD_MISMATCH,g[1])}}if(b[1]&&b[1].id==input.attr("id")){input.addClass("error");label.addClass("error")}});if(b.length>0){b[1].focus();if(d(c).hasClass("validation-alerts")){alert(b[0])}h=false}return h}function validateForms(){var b=jqnc(),a=b("form.validate");a.bind("submit.validate",function(c){return validate(this)})}jQuery(document).ready(function(){var a=jqnc();validateForms();catalogViewHandler();slideshows();carousels();if(a.fn.colorbox){a("a.shopp-zoom").colorbox({photo:true});a("a.shopp-zoom.gallery").attr("rel","gallery").colorbox({slideshow:true,slideshowSpeed:3500})}if(ShoppSettings.nocache){a(window).unload(function(){return})}});